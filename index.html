<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–û–ø—Ç–∏–º–∏–∑–∞—Ç–æ—Ä —Ñ–æ—Ç–æ –∑–∞–Ω—è—Ç–∏–π</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            padding: 20px;
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 600px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        h1 {
            text-align: center;
            margin-bottom: 25px;
            font-size: 28px;
            color: #2c3e50;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .upload-section {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            border: 2px dashed #ddd;
            border-radius: 15px;
            background: #f8f9fa;
            transition: all 0.3s;
        }

        .upload-section:hover {
            border-color: #007AFF;
            background: #e8f4fc;
        }

        .file-input {
            display: none;
        }

        .upload-btn {
            display: inline-block;
            padding: 18px 30px;
            background: linear-gradient(135deg, #007AFF, #0056cc);
            color: white;
            border-radius: 15px;
            cursor: pointer;
            font-size: 18px;
            font-weight: 600;
            border: none;
            width: 100%;
            transition: transform 0.2s;
            box-shadow: 0 4px 12px rgba(0, 122, 255, 0.3);
        }

        .upload-btn:active {
            transform: scale(0.98);
        }

        .tagger-section {
            display: none;
        }

        .settings-panel {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
            border-left: 4px solid #007AFF;
        }

        .settings-title {
            font-weight: 600;
            margin-bottom: 15px;
            color: #2c3e50;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 10px;
            font-weight: 600;
            color: #2c3e50;
            font-size: 16px;
        }

        .form-group input, .form-group select {
            width: 100%;
            padding: 16px;
            border: 2px solid #ddd;
            border-radius: 12px;
            font-size: 16px;
            background: white;
            transition: border-color 0.3s;
        }

        .form-group input:focus, .form-group select:focus {
            border-color: #007AFF;
            outline: none;
            box-shadow: 0 0 0 3px rgba(0, 122, 255, 0.1);
        }

        .slider-container {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .slider {
            flex: 1;
            -webkit-appearance: none;
            height: 8px;
            background: #ddd;
            border-radius: 4px;
            outline: none;
        }

        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 22px;
            height: 22px;
            border-radius: 50%;
            background: #007AFF;
            cursor: pointer;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }

        .slider-value {
            min-width: 50px;
            text-align: center;
            font-weight: 600;
            color: #007AFF;
        }

        .photo-preview {
            width: 100%;
            max-height: 350px;
            border-radius: 15px;
            margin: 20px 0;
            object-fit: contain;
            border: 2px dashed #ddd;
            background: #f8f9fa;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }

        .comparison-container {
            display: flex;
            gap: 15px;
            margin: 20px 0;
        }

        .comparison-box {
            flex: 1;
            text-align: center;
            padding: 15px;
            border-radius: 12px;
            background: #f8f9fa;
        }

        .comparison-title {
            font-weight: 600;
            margin-bottom: 10px;
            color: #2c3e50;
        }

        .file-size {
            font-size: 14px;
            color: #7f8c8d;
        }

        .action-buttons {
            display: flex;
            gap: 12px;
            margin-top: 25px;
        }

        .action-btn {
            flex: 1;
            padding: 18px;
            border: none;
            border-radius: 12px;
            font-size: 17px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 2px 8px rgba(0,0,0,0.15);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .action-btn:active {
            transform: translateY(2px);
        }

        .skip-btn {
            background: linear-gradient(135deg, #FF9500, #f39c12);
            color: white;
        }

        .download-btn {
            background: linear-gradient(135deg, #34C759, #27ae60);
            color: white;
        }

        .status {
            text-align: center;
            margin: 15px 0;
            padding: 15px;
            border-radius: 10px;
            font-weight: 500;
            font-size: 15px;
        }

        .success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .info {
            background: #e8f4fc;
            color: #0c5460;
            border: 1px solid #b8daff;
        }

        .file-info {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 12px;
            margin: 15px 0;
            font-size: 14px;
            border-left: 4px solid #007AFF;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e9ecef;
            border-radius: 4px;
            margin: 15px 0;
            overflow: hidden;
        }

        .progress {
            height: 100%;
            background: linear-gradient(135deg, #007AFF, #0056cc);
            border-radius: 4px;
            transition: width 0.3s;
            width: 0%;
        }

        .child-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 10px;
            margin: 20px 0;
        }

        .child-btn {
            padding: 15px;
            border: 2px solid #007AFF;
            border-radius: 12px;
            background: white;
            color: #007AFF;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 16px;
            text-align: center;
        }

        .child-btn.active {
            background: #007AFF;
            color: white;
        }

        .child-btn:hover {
            background: #007AFF;
            color: white;
        }

        .children-section {
            margin-bottom: 20px;
        }

        .children-section h3 {
            margin-bottom: 15px;
            color: #2c3e50;
            text-align: center;
        }

        .savings {
            text-align: center;
            font-weight: 600;
            color: #27ae60;
            margin: 10px 0;
        }

        @media (max-width: 500px) {
            .comparison-container {
                flex-direction: column;
            }
            
            .action-buttons {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üì∑ –û–ø—Ç–∏–º–∏–∑–∞—Ç–æ—Ä —Ñ–æ—Ç–æ –∑–∞–Ω—è—Ç–∏–π</h1>
        
        <div class="upload-section">
            <input type="file" id="photoInput" class="file-input" accept="image/*" multiple>
            <button onclick="document.getElementById('photoInput').click()" class="upload-btn">
                üì∏ –í—ã–±—Ä–∞—Ç—å —Ñ–æ—Ç–æ –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
            </button>
            <p style="margin-top: 15px; color: #7f8c8d; font-size: 14px;">
                –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è JPG, PNG –∏ WebP —Ñ–æ—Ä–º–∞—Ç—ã
            </p>
        </div>
        
        <div id="taggerSection" class="tagger-section">
            <div class="progress-bar">
                <div class="progress" id="progressBar"></div>
            </div>
            
            <div class="file-info" id="fileInfo"></div>
            
            <img id="photoPreview" class="photo-preview">
            
            <div class="settings-panel">
                <div class="settings-title">
                    <span>‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏</span>
                </div>
                
                <div class="form-group">
                    <label for="formatSelect">–§–æ—Ä–º–∞—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è:</label>
                    <select id="formatSelect">
                        <option value="webp">WebP (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)</option>
                        <option value="jpeg">JPEG</option>
                        <option value="png">PNG</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="qualitySlider">–ö–∞—á–µ—Å—Ç–≤–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è:</label>
                    <div class="slider-container">
                        <input type="range" min="30" max="100" value="80" class="slider" id="qualitySlider">
                        <span class="slider-value" id="qualityValue">80%</span>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="sizeSlider">–†–∞–∑–º–µ—Ä –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è (% –æ—Ç –æ—Ä–∏–≥–∏–Ω–∞–ª–∞):</label>
                    <div class="slider-container">
                        <input type="range" min="10" max="100" value="80" class="slider" id="sizeSlider">
                        <span class="slider-value" id="sizeValue">80%</span>
                    </div>
                </div>
            </div>
            
            <div class="comparison-container">
                <div class="comparison-box">
                    <div class="comparison-title">–ò—Å—Ö–æ–¥–Ω—ã–π —Ä–∞–∑–º–µ—Ä</div>
                    <div id="originalSize" class="file-size">‚Äî</div>
                </div>
                <div class="comparison-box">
                    <div class="comparison-title">–ù–æ–≤—ã–π —Ä–∞–∑–º–µ—Ä</div>
                    <div id="newSize" class="file-size">‚Äî</div>
                </div>
            </div>
            
            <div id="savings" class="savings"></div>
            
            <div class="children-section">
                <h3>–í—ã–±–µ—Ä–∏—Ç–µ —Ä–µ–±–µ–Ω–∫–∞:</h3>
                <div class="child-buttons" id="childButtons">
                    <button class="child-btn" data-id="YAKOV2020">–Ø–∫–æ–≤ –°–∏—Ç–¥–∏–∫–æ–≤</button>
                    <button class="child-btn" data-id="ARINA2020">–ê—Ä–∏–Ω–∞ –†–æ–¥–∏–æ–Ω–æ–≤–Ω–∞</button>
                    <button class="child-btn" data-id="VASYA2020">–í–∞—Å—è –ü—É–ø–∫–∏–Ω</button>
                </div>
            </div>
            
            <div class="form-group">
                <label for="lessonNumber">–ù–æ–º–µ—Ä –∑–∞–Ω—è—Ç–∏—è:</label>
                <input type="number" id="lessonNumber" min="1" value="1">
            </div>
            
            <div class="action-buttons">
                <button onclick="skipPhoto()" class="action-btn skip-btn">
                    <span>‚è≠Ô∏è</span> –ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å —Ñ–æ—Ç–æ
                </button>
                <button onclick="processAndDownload()" class="action-btn download-btn">
                    <span>üíæ</span> –°–∫–∞—á–∞—Ç—å –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —Ñ–æ—Ç–æ
                </button>
            </div>
            
            <div id="status" class="status info"></div>
        </div>
    </div>

    <script>
        // –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –¥–µ—Ç–µ–π
        const children = [
            { id: "YAKOV2020", name: "–Ø–∫–æ–≤ –°–∏—Ç–¥–∏–∫–æ–≤" },
            { id: "ARINA2020", name: "–ê—Ä–∏–Ω–∞ –†–æ–¥–∏–æ–Ω–æ–≤–Ω–∞" },
            { id: "VASYA2020", name: "–í–∞—Å—è –ü—É–ø–∫–∏–Ω" }
        ];

        let currentPhotos = [];
        let currentIndex = 0;
        let selectedChild = '';
        let originalImageSize = 0;
        let optimizedImageSize = 0;

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        document.addEventListener('DOMContentLoaded', function() {
            setupEventListeners();
            showStatus('–í—ã–±–µ—Ä–∏—Ç–µ —Ñ–æ—Ç–æ –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è', 'info');
        });

        function setupEventListeners() {
            // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–ª–∞–π–¥–µ—Ä–æ–≤
            const qualitySlider = document.getElementById('qualitySlider');
            const qualityValue = document.getElementById('qualityValue');
            qualitySlider.addEventListener('input', function() {
                qualityValue.textContent = this.value + '%';
                if (currentPhotos.length > 0) {
                    updatePreview();
                }
            });

            const sizeSlider = document.getElementById('sizeSlider');
            const sizeValue = document.getElementById('sizeValue');
            sizeSlider.addEventListener('input', function() {
                sizeValue.textContent = this.value + '%';
                if (currentPhotos.length > 0) {
                    updatePreview();
                }
            });

            // –í—ã–±–æ—Ä —Ñ–æ—Ä–º–∞—Ç–∞
            document.getElementById('formatSelect').addEventListener('change', function() {
                if (currentPhotos.length > 0) {
                    updatePreview();
                }
            });

            // –í—ã–±–æ—Ä —Ä–µ–±–µ–Ω–∫–∞
            document.querySelectorAll('.child-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    selectedChild = this.getAttribute('data-id');
                    document.querySelectorAll('.child-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                });
            });

            // –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤
            const fileInput = document.getElementById('photoInput');
            fileInput.addEventListener('change', handleFileSelect);
        }

        function handleFileSelect(event) {
            const files = Array.from(event.target.files);
            if (files.length === 0) return;

            currentPhotos = files;
            currentIndex = 0;
            showTaggerSection();
            showCurrentPhoto();
        }

        function showTaggerSection() {
            document.getElementById('taggerSection').style.display = 'block';
            document.querySelector('.upload-section').style.display = 'none';
            updateProgress();
        }

        function showCurrentPhoto() {
            if (currentIndex >= currentPhotos.length) {
                showStatus('üéâ –í—Å–µ —Ñ–æ—Ç–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω—ã!', 'success');
                return;
            }

            const file = currentPhotos[currentIndex];
            originalImageSize = file.size;
            updateFileInfo(file);
            
            const reader = new FileReader();
            reader.onload = function(e) {
                document.getElementById('photoPreview').src = e.target.result;
                selectedChild = '';
                document.querySelectorAll('.child-btn').forEach(btn => {
                    btn.classList.remove('active');
                });
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
                setTimeout(updatePreview, 100);
            };
            
            reader.readAsDataURL(file);
        }

        function updatePreview() {
            if (currentIndex >= currentPhotos.length) return;

            const file = currentPhotos[currentIndex];
            const quality = parseInt(document.getElementById('qualitySlider').value);
            const scale = parseInt(document.getElementById('sizeSlider').value) / 100;
            const format = document.getElementById('formatSelect').value;

            const img = new Image();
            img.onload = function() {
                const canvas = document.createElement('canvas');
                const ctx = canvas.getContext('2d');
                
                // –í—ã—á–∏—Å–ª—è–µ–º –Ω–æ–≤—ã–µ —Ä–∞–∑–º–µ—Ä—ã
                const newWidth = Math.round(img.width * scale);
                const newHeight = Math.round(img.height * scale);
                
                canvas.width = newWidth;
                canvas.height = newHeight;
                
                // –†–∏—Å—É–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å –Ω–æ–≤—ã–º–∏ —Ä–∞–∑–º–µ—Ä–∞–º–∏
                ctx.drawImage(img, 0, 0, newWidth, newHeight);
                
                // –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º –≤ –≤—ã–±—Ä–∞–Ω–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç
                let mimeType = 'image/jpeg';
                if (format === 'webp') mimeType = 'image/webp';
                else if (format === 'png') mimeType = 'image/png';
                
                canvas.toBlob(function(blob) {
                    optimizedImageSize = blob.size;
                    updateComparison();
                    document.getElementById('photoPreview').src = URL.createObjectURL(blob);
                }, mimeType, quality / 100);
            };
            
            img.src = URL.createObjectURL(file);
        }

        function updateFileInfo(file) {
            const fileInfo = document.getElementById('fileInfo');
            const size = formatFileSize(file.size);
            fileInfo.innerHTML = `
                <strong>–§–æ—Ç–æ ${currentIndex + 1} –∏–∑ ${currentPhotos.length}</strong><br>
                –ò–º—è: ${file.name}<br>
                –†–∞–∑–º–µ—Ä: ${size}<br>
                –¢–∏–ø: ${file.type || 'image'}
            `;
        }

        function updateComparison() {
            document.getElementById('originalSize').textContent = formatFileSize(originalImageSize);
            document.getElementById('newSize').textContent = formatFileSize(optimizedImageSize);
            
            const savings = originalImageSize - optimizedImageSize;
            const percent = (savings / originalImageSize * 100).toFixed(1);
            
            if (savings > 0) {
                document.getElementById('savings').textContent = 
                    `–≠–∫–æ–Ω–æ–º–∏—è: ${formatFileSize(savings)} (${percent}%)`;
            } else {
                document.getElementById('savings').textContent = '';
            }
        }

        function formatFileSize(bytes) {
            if (bytes < 1024) return bytes + ' B';
            else if (bytes < 1048576) return (bytes / 1024).toFixed(1) + ' KB';
            else return (bytes / 1048576).toFixed(1) + ' MB';
        }

        function processAndDownload() {
            if (!selectedChild) {
                showStatus('–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ —Ä–µ–±–µ–Ω–∫–∞!', 'error');
                return;
            }

            const file = currentPhotos[currentIndex];
            const lessonNumber = document.getElementById('lessonNumber').value;
            const quality = parseInt(document.getElementById('qualitySlider').value);
            const scale = parseInt(document.getElementById('sizeSlider').value) / 100;
            const format = document.getElementById('formatSelect').value;
            const child = children.find(c => c.id === selectedChild);
            
            const img = new Image();
            img.onload = function() {
                const canvas = document.createElement('canvas');
                const ctx = canvas.getContext('2d');
                
                // –í—ã—á–∏—Å–ª—è–µ–º –Ω–æ–≤—ã–µ —Ä–∞–∑–º–µ—Ä—ã
                const newWidth = Math.round(img.width * scale);
                const newHeight = Math.round(img.height * scale);
                
                canvas.width = newWidth;
                canvas.height = newHeight + 60; // –ú–µ—Å—Ç–æ –¥–ª—è —Ç–µ–∫—Å—Ç–∞
                
                // –ó–∞–ª–∏–≤–∞–µ–º –±–µ–ª—ã–º —Ñ–æ–Ω
                ctx.fillStyle = 'white';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                
                // –†–∏—Å—É–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
                ctx.drawImage(img, 0, 60, newWidth, newHeight);
                
                // –î–æ–±–∞–≤–ª—è–µ–º —Ç–µ–∫—Å—Ç —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π
                ctx.fillStyle = '#2c3e50';
                ctx.font = '20px Arial';
                ctx.textAlign = 'center';
                ctx.fillText(`${child.name} - –ó–∞–Ω—è—Ç–∏–µ ${lessonNumber}`, canvas.width/2, 30);
                
                // –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º –≤ –≤—ã–±—Ä–∞–Ω–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç
                let mimeType = 'image/jpeg';
                let extension = 'jpg';
                
                if (format === 'webp') {
                    mimeType = 'image/webp';
                    extension = 'webp';
                } else if (format === 'png') {
                    mimeType = 'image/png';
                    extension = 'png';
                }
                
                canvas.toBlob(function(blob) {
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `${child.name}_–∑–∞–Ω—è—Ç–∏–µ_${lessonNumber}.${extension}`;
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);
                    
                    showStatus('‚úÖ –§–æ—Ç–æ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–æ –∏ —Å–∫–∞—á–∞–Ω–æ!', 'success');
                    
                    // –ü–µ—Ä–µ—Ö–æ–¥–∏–º –∫ —Å–ª–µ–¥—É—é—â–µ–º—É —Ñ–æ—Ç–æ
                    currentIndex++;
                    updateProgress();
                    setTimeout(showCurrentPhoto, 1500);
                }, mimeType, quality / 100);
            };
            
            img.src = URL.createObjectURL(file);
        }

        function skipPhoto() {
            currentIndex++;
            updateProgress();
            showCurrentPhoto();
        }

        function updateProgress() {
            const progress = (currentIndex / currentPhotos.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
        }

        function showStatus(message, type = '') {
            const statusDiv = document.getElementById('status');
            statusDiv.textContent = message;
            statusDiv.className = `status ${type}`;
        }
    </script>
</body>
</html>
